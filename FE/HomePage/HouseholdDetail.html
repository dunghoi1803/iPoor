<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPOOR | Hồ sơ hộ nghèo</title>
    <link rel="icon" type="image/png" href="../Image/icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy-900: #0f172a;
            --navy-800: #162544;
            --navy-700: #1f2f54;
            --blue-500: #3b82f6;
            --blue-100: #e1ecff;
            --gray-50: #f5f7fa;
            --gray-100: #e5e7eb;
            --gray-200: #e2e8f0;
            --gray-400: #94a3b8;
            --gray-500: #6b7280;
            --white: #ffffff;
            --card-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
            --green-500: #22c55e;
            --red-500: #dc2626;
            --amber-500: #f59e0b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Manrope', system-ui, -apple-system, sans-serif; background: var(--gray-50); color: var(--navy-900); }

        .app-shell { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
        .sidebar { background: var(--navy-900); color: var(--white); display: flex; flex-direction: column; padding: 20px 18px; }
        .brand { display: flex; align-items: center; gap: 12px; padding: 10px 12px 20px; }
        .brand-mark { width: 44px; height: 44px; border-radius: 12px; background: var(--white); display: grid; place-items: center; }
        .brand-logo { width: 30px; height: 30px; object-fit: contain; }
        .brand-name { font-size: 18px; font-weight: 700; letter-spacing: 0.4px; }
        nav { margin-top: 8px; display: grid; gap: 6px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; border-radius: 10px; color: var(--white); text-decoration: none; transition: background 0.2s, transform 0.1s; }
        .nav-item:hover { background: var(--navy-800); transform: translateX(2px); }
        .nav-item.active { background: var(--navy-700); border-left: 3px solid var(--blue-500); }
        .nav-icon { width: 16px; height: 16px; display: inline-flex; align-items: center; justify-content: center; }

        .main-area { display: flex; flex-direction: column; min-height: 100vh; }
        .topbar { background: var(--white); height: 72px; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; box-shadow: 0 1px 0 rgba(148, 163, 184, 0.35); position: relative; }
        .breadcrumb { color: var(--gray-500); font-weight: 600; letter-spacing: 0.2px; }
        .breadcrumb strong { color: var(--navy-900); }
        .user-meta { display: flex; align-items: center; gap: 12px; position: relative; }
        .avatar { width: 38px; height: 38px; border-radius: 50%; background: var(--blue-500); color: var(--white); display: grid; place-items: center; font-weight: 700; }
        .user-info { display: flex; flex-direction: column; align-items: flex-end; }
        .user-name { font-weight: 700; }
        .user-role { color: var(--gray-500); font-size: 13px; }
        .dropdown { border: 1px solid var(--gray-100); border-radius: 10px; padding: 8px 12px; background: var(--white); display: flex; gap: 8px; align-items: center; cursor: pointer; transition: box-shadow 0.15s; }
        .dropdown:hover { box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12); }
        .dropdown-menu { position: absolute; right: 0; top: 60px; background: var(--white); border: 1px solid var(--gray-100); border-radius: 12px; box-shadow: 0 14px 28px rgba(15,23,42,0.15); display: none; min-width: 180px; overflow: hidden; }
        .dropdown-menu.open { display: block; }
        .dropdown-item { width: 100%; text-align: left; padding: 10px 14px; border: none; background: transparent; cursor: pointer; font-weight: 600; color: var(--navy-900); transition: background 0.15s; }
        .dropdown-item:hover { background: #f8fafc; }

        .content { flex: 1; padding: 24px; background: var(--gray-50); display: grid; gap: 16px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        .page-title { font-size: 24px; font-weight: 800; letter-spacing: -0.2px; }
        .btn-edit { background: var(--blue-500); color: var(--white); border: none; border-radius: 10px; padding: 10px 14px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn-edit:hover { background: #2563eb; }

        .card { background: var(--white); border: 1px solid var(--gray-100); border-radius: 14px; box-shadow: var(--card-shadow); padding: 16px; display: grid; gap: 12px; }
        .card-title { font-weight: 800; font-size: 16px; }
        .grid-2col { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px 16px; }
        .field { display: grid; gap: 4px; }
        .label { color: var(--gray-500); font-weight: 700; font-size: 13px; }
        .value { font-weight: 700; color: var(--navy-900); }

        .badge { padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; display: inline-flex; align-items: center; }
        .badge-ngheo { background: #fee2e2; color: #b91c1c; }
        .badge-can { background: #fff7ed; color: #c2410c; }
        .badge-thoat { background: #ecfdf3; color: #15803d; }
        .badge-nguyco { background: #fef9c3; color: #b45309; }

        .score-box { display: inline-flex; align-items: center; gap: 6px; padding: 10px 12px; border-radius: 12px; background: #f8fafc; font-weight: 800; }

        .attachments { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
        .attach-card { border: 1px dashed var(--gray-200); border-radius: 12px; padding: 12px; display: grid; gap: 8px; background: #f8fafc; }
        .attach-preview { width: 100%; border-radius: 10px; border: 1px solid var(--gray-100); background: var(--white); padding: 8px; text-align: center; }
        .attach-link { color: var(--blue-500); font-weight: 700; text-decoration: none; }

        /* Form styles */
        .action-row { display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; }

        @media (max-width: 960px) {
            .app-shell { grid-template-columns: 72px 1fr; }
            .brand-name { display: none; }
            .nav-item .nav-text { display: none; }
        }
        @media (max-width: 680px) {
            .app-shell { grid-template-columns: 1fr; }
            .sidebar { flex-direction: row; overflow-x: auto; height: 72px; }
            nav { grid-auto-flow: column; grid-auto-columns: max-content; align-items: center; }
        }
            .menu-toggle {
            margin-left: auto;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.35);
            background: transparent;
            color: var(--white);
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .menu-toggle svg { width: 18px; height: 18px; }

        @media (max-width: 1024px) {
            .app-shell { grid-template-columns: 72px 1fr; }
            .sidebar { padding: 16px 10px; }
            .brand { justify-content: space-between; padding: 8px 6px 16px; }
            .brand-name { display: none; }
            .menu-toggle { display: inline-flex; }
            .nav-item { justify-content: center; }
            .nav-item .nav-text { display: none; }
            .sidebar.expanded { padding: 20px 18px; }
            .sidebar.expanded .brand-name { display: block; }
            .sidebar.expanded .nav-item { justify-content: flex-start; }
            .sidebar.expanded .nav-item .nav-text { display: inline; }
            .app-shell.menu-expanded { grid-template-columns: 240px 1fr; }
        }
        @media (max-width: 680px) {
            .app-shell { grid-template-columns: 72px 1fr; }
            .sidebar { flex-direction: column; height: auto; overflow: hidden; }
            nav { grid-auto-flow: row; }
        }
            @media (max-width: 1024px) {
            .app-shell { grid-template-columns: 72px 1fr; }
            .sidebar { flex-direction: column; overflow: hidden; height: auto; }
            nav { grid-auto-flow: row; grid-auto-columns: initial; align-items: stretch; }
        }
            @media (max-width: 1024px) {
            .brand { flex-direction: column; align-items: flex-start; gap: 8px; }
            .brand-mark { order: 1; }
            .menu-toggle { order: 2; align-self: flex-end; }
            .brand-name { order: 3; }
            .sidebar.expanded .brand { align-items: flex-start; }
        }
            @media (max-width: 1024px) {
            .sidebar.expanded .brand {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                gap: 8px 12px;
            }
            .sidebar.expanded .brand-mark { order: 1; }
            .sidebar.expanded .brand-name { order: 2; display: block; }
            .sidebar.expanded .menu-toggle {
                order: 3;
                width: 100%;
                align-self: flex-start;
                margin-top: 8px;
            }
        }
            @media (max-width: 1024px) {
            .sidebar.expanded .brand { justify-content: flex-start; gap: 8px; }
            .sidebar.expanded .brand-name { margin-left: 0; }
            .sidebar.expanded .menu-toggle {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                margin-top: 8px;
            }
        }
            @media (max-width: 1024px) {
            .nav-item .nav-text { display: none; }
            .sidebar.expanded .nav-item .nav-text { display: inline; }
        }
    </style>
</head>
<body>
<div class="app-shell">
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-mark"><img src="../Image/icon.png" alt="iPOOR" class="brand-logo"></div>
            <div class="brand-name">iPOOR</div>
            <button class="menu-toggle" type="button" aria-label="Mở menu">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
                <nav>
            <a class="nav-item" href="../LandingPage/index.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 7.5 8 2l6 5.5V14H9.5v-3h-3v3H2V7.5Z" fill="white" opacity="0.9"/>`</svg></span>
                <span class="nav-text">Trang giới thiệu</span>
            </a>
            <a class="nav-item" href="./HomePage.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 2a6 6 0 0 0-6 6v2.5A1.5 1.5 0 0 0 3.5 12h9A1.5 1.5 0 0 0 14 10.5V8a6 6 0 0 0-6-6Z" stroke="white" stroke-width="1.3"/><path d="M8 8 10.8 6.2" stroke="white" stroke-width="1.3" stroke-linecap="round"/><circle cx="8" cy="8" r="1" fill="white"/>`</svg></span>
                <span class="nav-text">Dashboard</span>
            </a>
            <a class="nav-item active" href="./HouseholdList.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="3" width="12" height="10" rx="2" stroke="white" stroke-width="1.4"/><path d="M5 3v10" stroke="white" stroke-width="1.2" opacity="0.7"/><circle cx="11" cy="7" r="1" fill="white"/>`</svg></span>
                <span class="nav-text">Quản lý hộ nghèo</span>
            </a>
            <a class="nav-item" href="./DataCollection.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2.5 5.5h11v1.5h-11V5.5Zm0 3h7v1.5h-7V8.5Zm0 3h5v1.5h-5V11.5Z" fill="white" opacity="0.9"/><path d="M10.5 3v10" stroke="white" stroke-width="1.2" opacity="0.7"/>`</svg></span>
                <span class="nav-text">Thu thập & cập nhật dữ liệu</span>
            </a>
            <a class="nav-item" href="./PolicyList.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 13V3h10v10H3Z" stroke="white" stroke-width="1.3"/><path d="M5 6.5h6M5 9h3.5" stroke="white" stroke-width="1.2" stroke-linecap="round"/>`</svg></span>
                <span class="nav-text">Chính sách & báo cáo</span>
            </a>
            <a class="nav-item" href="./GISMap.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2.7 7.3c0-2.5 2-4.5 4.5-4.5s4.5 2 4.5 4.5-2 4.5-4.5 4.5c-.7 0-1.3-.15-1.9-.44l-2.05.58.55-1.95c-.36-.62-.6-1.34-.6-2.09Z" stroke="white" stroke-width="1.3"/><path d="M6.5 6.8c0-.7.6-1.2 1.2-1.2.7 0 1.2.5 1.2 1.2 0 .6-.5 1.2-1.2 1.2-.7 0-1.2-.6-1.2-1.2Z" fill="white"/>`</svg></span>
                <span class="nav-text">Bản đồ nghèo (GIS)</span>
            </a>
            <a class="nav-item" href="./ActivityLogs.html">
                <span class="nav-icon"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4.5 3.5h7m-7 9h7M8 1.5v2m0 9v2M5.5 6h5L9.8 10H6.2L5.5 6Z" stroke="white" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>`</svg></span>
                <span class="nav-text">Nhật ký hoạt động</span>
            </a>
        </nav>
    </aside>

    <div class="main-area">
        <header class="topbar">
            <div class="breadcrumb"><strong>Trang chủ</strong> / Quản lý hộ nghèo / Hồ sơ</div>
            <div class="user-meta">
                <div class="user-info">
                    <span class="user-name" id="userName">Nguyễn Văn A</span>
                    <span class="user-role" id="userRole">Cán bộ tỉnh</span>
                </div>
                <div class="avatar" id="userAvatar">NA</div>
                <button class="dropdown" id="accountDropdown">Tài khoản ▾</button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <button class="dropdown-item" data-action="change-password">Đổi mật khẩu</button>
                    <button class="dropdown-item" data-action="logout">Đăng xuất</button>
                </div>
            </div>
        </header>

        <main class="content">
            <div class="page-header">
                <div>
                    <div class="page-title" id="pageTitle">Hồ sơ hộ nghèo</div>
                    <div class="breadcrumb" style="margin-top:6px;"><strong>Trang chủ</strong> / Quản lý hộ nghèo / Hồ sơ</div>
                </div>
                <a class="btn-edit" id="editLink" href="./HouseholdEdit.html">Chỉnh sửa</a>
            </div>

            <!-- Thông tin chung -->
            <section class="card">
                <div class="card-title">Thông tin chung</div>
                <div class="view-section grid-2col">
                    <div class="field"><span class="label">Họ và tên</span><span class="value" id="fullName">-</span></div>
                    <div class="field"><span class="label">Ngày sinh</span><span class="value" id="dob">-</span></div>
                    <div class="field"><span class="label">Giới tính</span><span class="value" id="gender">-</span></div>
                    <div class="field"><span class="label">Dân tộc</span><span class="value" id="ethnic">-</span></div>
                    <div class="field"><span class="label">CCCD</span><span class="value" id="idCard">-</span></div>
                    <div class="field"><span class="label">Số thành viên</span><span class="value" id="members">-</span></div>
                </div>
            </section>

            <!-- Thông tin nghèo đa chiều -->
            <section class="card">
                <div class="card-title">Thông tin nghèo đa chiều</div>
                <div class="view-section grid-2col">
                    <div class="field"><span class="label">Trạng thái</span><span class="value" id="statusBadge">-</span></div>
                    <div class="field"><span class="label">Điểm B1</span><span class="score-box" id="scoreB1">-</span></div>
                    <div class="field"><span class="label">Điểm B2</span><span class="score-box" id="scoreB2">-</span></div>
                    <div class="field"><span class="label">Mô tả</span><span class="value" id="note">-</span></div>
                </div>
            </section>

            <!-- Thông tin địa bàn & rà soát -->
            <section class="card">
                <div class="card-title">Địa bàn & rà soát</div>
                <div class="view-section grid-2col">
                    <div class="field"><span class="label">Tỉnh/TP</span><span class="value" id="province">-</span></div>
                    <div class="field"><span class="label">Phường/Xã</span><span class="value" id="commune">-</span></div>
                    <div class="field"><span class="label">Khu vực</span><span class="value" id="area">-</span></div>
                    <div class="field"><span class="label">Thôn/Xóm</span><span class="value" id="village">-</span></div>
                    <div class="field"><span class="label">Cán bộ rà soát</span><span class="value" id="officer">-</span></div>
                    <div class="field"><span class="label">Ngày rà soát</span><span class="value" id="reviewDate">-</span></div>
                    <div class="field"><span class="label">Ghi chú</span><span class="value" id="remark">-</span></div>
                </div>
            </section>

            <!-- Tài liệu đính kèm -->
            <section class="card">
                <div class="card-title">Tài liệu đính kèm</div>
                <div class="attachments view-section" id="attachments">
                    <div class="attach-card">
                        <div class="label">File PDF tổng hợp</div>
                        <a class="attach-link" id="attachmentLink" href="#" target="_blank" rel="noopener">Tải tài liệu</a>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>
<script>
    const dropdownBtn = document.getElementById('accountDropdown');
    const dropdownMenu = document.getElementById('dropdownMenu');
    function closeMenu() { dropdownMenu.classList.remove('open'); }
    dropdownBtn.addEventListener('click', (e) => { e.stopPropagation(); dropdownMenu.classList.toggle('open'); });
    dropdownMenu.addEventListener('click', (e) => {
        e.stopPropagation();
        if (e.target.dataset.action === 'logout') window.location.href = '../Auth/Login.html';
        if (e.target.dataset.action === 'change-password') window.location.href = '../Auth/ForgotPassword.html';
        closeMenu();
    });
    document.addEventListener('click', closeMenu);

    const API_BASE_URL = sessionStorage.getItem('ipoor_api_base') || 'http://127.0.0.1:8000';
    const TOKEN_STORAGE_KEY = 'ipoor_access_token';
    const USER_PROFILE_ENDPOINT = `${API_BASE_URL}/auth/me`;
    const HOUSEHOLD_SELECTED_KEY = 'ipoor_household_selected_id';
    const HOUSEHOLD_CACHE_KEY = 'ipoor_household_cache';

    const pageTitle = document.getElementById('pageTitle');
    const editLink = document.getElementById('editLink');
    const fullName = document.getElementById('fullName');
    const dob = document.getElementById('dob');
    const gender = document.getElementById('gender');
    const ethnic = document.getElementById('ethnic');
    const idCard = document.getElementById('idCard');
    const members = document.getElementById('members');
    const statusBadge = document.getElementById('statusBadge');
    const scoreB1 = document.getElementById('scoreB1');
    const scoreB2 = document.getElementById('scoreB2');
    const note = document.getElementById('note');
    const province = document.getElementById('province');
    const commune = document.getElementById('commune');
    const area = document.getElementById('area');
    const village = document.getElementById('village');
    const officer = document.getElementById('officer');
    const reviewDate = document.getElementById('reviewDate');
    const remark = document.getElementById('remark');
    const attachmentLink = document.getElementById('attachmentLink');
    const attachments = document.getElementById('attachments');
    const userNameEl = document.getElementById('userName');
    const userRoleEl = document.getElementById('userRole');
    const userAvatarEl = document.getElementById('userAvatar');
    const roleLabels = {
        admin: 'Quản trị viên',
        province_officer: 'Cán bộ tỉnh',
        district_officer: 'Cán bộ huyện',
        commune_officer: 'Cán bộ xã',
    };

    const STATUS_LABELS = {
        poor: { text: 'Nghèo', cls: 'badge-ngheo' },
        near_poor: { text: 'Cận nghèo', cls: 'badge-can' },
        escaped_poverty: { text: 'Thoát nghèo', cls: 'badge-thoat' },
        at_risk: { text: 'Nguy cơ tái nghèo', cls: 'badge-nguyco' },
    };

    function getToken() {
        return localStorage.getItem(TOKEN_STORAGE_KEY) || sessionStorage.getItem(TOKEN_STORAGE_KEY);
    }

    function buildInitials(name) {
        if (!name) return 'NA';
        const parts = name.trim().split(/\s+/);
        const initials = parts.slice(-2).map((part) => part[0]).join('');
        return initials.toUpperCase() || 'NA';
    }

    async function loadUserProfile() {
        const token = getToken();
        if (!token) return;
        const res = await fetch(USER_PROFILE_ENDPOINT, {
            headers: { Authorization: `Bearer ${token}` },
        });
        if (res.status === 401) {
            localStorage.removeItem(TOKEN_STORAGE_KEY);
            sessionStorage.removeItem(TOKEN_STORAGE_KEY);
            window.location.href = '../Auth/Login.html';
            return;
        }
        if (!res.ok) return;
        const profile = await res.json();
        const fullName = profile.full_name || profile.email || 'N/A';
        if (userNameEl) userNameEl.textContent = fullName;
        if (userRoleEl) userRoleEl.textContent = roleLabels[profile.role] || profile.role || 'N/A';
        if (userAvatarEl) userAvatarEl.textContent = buildInitials(fullName);
    }

    function normalizeAttachmentUrl(value) {
        if (!value) return '';
        if (value.startsWith('http://') || value.startsWith('https://')) return value;
        if (value.startsWith('/')) return `${API_BASE_URL}${value}`;
        return value;
    }

    function formatDate(value) {
        if (!value) return '-';
        const d = new Date(value);
        return isNaN(d.getTime()) ? '-' : d.toLocaleDateString('vi-VN');
    }

    function renderStatus(value) {
        if (!value) return '-';
        const mapped = STATUS_LABELS[value];
        if (!mapped) return value;
        return `<span class="badge ${mapped.cls}">${mapped.text}</span>`;
    }

    function renderHousehold(data) {
        pageTitle.textContent = `Hồ sơ hộ nghèo – ${data.head_name || 'Không rõ'}`;
        fullName.textContent = data.head_name || '-';
        dob.textContent = formatDate(data.birth_date);
        gender.textContent = data.gender || '-';
        ethnic.textContent = data.ethnicity || '-';
        idCard.textContent = data.id_card || data.household_code || '-';
        members.textContent = data.members_count ?? '-';
        statusBadge.innerHTML = renderStatus(data.poverty_status);
        scoreB1.textContent = data.score_b1 != null ? `${data.score_b1} / 100` : '-';
        scoreB2.textContent = data.score_b2 != null ? `${data.score_b2} / 100` : '-';
        note.textContent = data.note || '-';
        province.textContent = data.province || '-';
        commune.textContent = data.commune || '-';
        area.textContent = data.area || data.district || '-';
        village.textContent = data.village || data.address_line || '-';
        officer.textContent = data.officer || '-';
        reviewDate.textContent = formatDate(data.last_surveyed_at);
        remark.textContent = data.remark || '-';

        const attachmentUrl = normalizeAttachmentUrl(data.attachment_url || '');
        if (attachmentUrl) {
            attachmentLink.href = attachmentUrl;
            attachmentLink.style.display = '';
        } else {
            attachmentLink.style.display = 'none';
            attachments.innerHTML = '<div class="attach-card"><div class="label">File PDF tổng hợp</div><div class="attach-preview">Chưa có tài liệu</div></div>';
        }
    }

    function getCachedHousehold(id) {
        const raw = sessionStorage.getItem(HOUSEHOLD_CACHE_KEY);
        if (!raw) return null;
        try {
            const cache = JSON.parse(raw);
            return cache[id] || null;
        } catch (_) {
            return null;
        }
    }

    async function loadDetail() {
        const token = getToken();
        if (!token) {
            window.location.href = '../Auth/Login.html';
            return;
        }
        const id = new URLSearchParams(window.location.search).get('id') || sessionStorage.getItem(HOUSEHOLD_SELECTED_KEY);
        if (!id) {
            pageTitle.textContent = 'Không tìm thấy hộ';
            return;
        }
        editLink.href = `./HouseholdEdit.html?id=${id}`;

        const cached = getCachedHousehold(id);
        if (cached) {
            renderHousehold(cached);
        }

        try {
            const res = await fetch(`${API_BASE_URL}/households/${id}`, {
                headers: { Authorization: `Bearer ${token}` },
            });
            if (res.status === 401) {
                localStorage.removeItem(TOKEN_STORAGE_KEY);
                sessionStorage.removeItem(TOKEN_STORAGE_KEY);
                window.location.href = '../Auth/Login.html';
                return;
            }
            if (res.status === 404) {
                pageTitle.textContent = 'Không tìm thấy hộ';
                return;
            }
            if (!res.ok) throw new Error('Không tải được hồ sơ hộ');
            const data = await res.json();
            renderHousehold(data);
        } catch (error) {
            pageTitle.textContent = error.message;
        }
    }

    loadUserProfile();
    loadDetail();
</script>
<script>
(() => {
  const appShell = document.querySelector('.app-shell');
  const sidebar = document.querySelector('.sidebar');
  const toggle = document.querySelector('.menu-toggle');
  if (!appShell || !sidebar || !toggle) return;
  toggle.addEventListener('click', () => {
    const expanded = sidebar.classList.toggle('expanded');
    appShell.classList.toggle('menu-expanded', expanded);
  });
})();
</script>
</body>
</html>














